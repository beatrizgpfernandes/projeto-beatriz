<!DOCTYPE html>
<html lang="ptbr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login | BloGuimarães</title>
    <link rel="stylesheet" href="css/stye-cadastro.css">
</head>

<body>

    <div class="telaGeral">
        <div class="header">
            <div class="container">
                <div class="blocoNavbar">
                    <img src="assets/imgs/logo.png" alt="">
                    <div class="navbar">
                        <a href="index.html #Home">
                            <li>Home</li>
                        </a>
                        <a href="index.html #SobreMim">
                            <li>Sobre Mim</li>
                        </a>
                        <a href="index.html #SobreBlog">
                            <li>Sobre o Blog</li>
                        </a>
                        <a href="index.html #Contato">
                            <li>Contato</li>
                        </a>
                        <li>|</li>
                        <button style="background-color: #FFDE59;">CADASTRO</button>
                        <a href="login.html"><button>LOGIN</button></a>
                    </div>
                </div>
            </div>
        </div>

        <div class="corpoCadastro">
            <div class="box">
                <h1>Cadastre-se</h1> <br>
                <div class="campos">
                    <div class="boxCad">
                        <input type="text" id="input_Nome" placeholder="Nome">
                        <input type="text" id="input_sobrenome" placeholder="Sobrenome">
                    </div>

                    <div class="boxCad">
                        <input type="date" id="input_dtNasc" placeholder="Nascimento">
                        <input type="text" id="input_email" placeholder="E-mail">
                    </div>

                    <div class="boxCad">
                        <input type="password" id="input_senha" placeholder="Senha">
                        <input type="password" id="input_confSenha" placeholder="Confirmar Senha">
                    </div>
                </div>
                <button onclick="cadastrar()">CADASTRAR</button>
                <div id="div_Erro"></div>
                <!-- <div id="div_aguardar" class="loading-div">
                    <img src="./assets/circle-loading.gif" id="loading-gif" />
                  </div> -->
            </div>
        </div>
    </div>

</body>

</html>

<script>

    function cadastrar() {
        var varNome = input_Nome.value;
        var varSobrenome = input_sobrenome.value;
        var varDtNasc = input_dtNasc.value;
        var varEmail = input_email.value;
        var varSenha = input_senha.value;
        var varConfSenha = input_confSenha.value;

        var tamanhoNome = varNome.length;
        var tamanhoSobrenome = varSobrenome.length;
        var tamanhoSenha= varSenha.length;
        var tamanhoConfSenha = varConfSenha.length;

        var indicePonto = varEmail.indexOf('.');
        var indiceArroba = varEmail.indexOf('@');

        if (varNome == '' || varSobrenome == '' || varDtNasc == '' || varEmail == '' || varSenha == '' || varConfSenha == '') {
            div_mensagem.innerHTML = 'Todos os campos devem estar preenchidos!'

        } else {

        if (tamanhoNome <= 1 || tamanhoSobrenome <=1) {
        div_Erro.innerHTML = 'O campo nome e sobrenome devem conter mais que um caractere! '
        finalizarAguardar();
        return false;
    }
        }
        if (indiceArroba < 0 || indicePonto < 0) {
        div_Erro.innerHTML = 'O campo email deve conter arroba e ponto'
      finalizarAguardar();
      return false;
    }
    if (tamanhoSenha <= 5) {
      div_Erro.innerHTML = "(O campo senha deve conter mais que seis caracteres)"
      finalizarAguardar();
      return false;
    }

    if(varSenha != varConfSenha) {
      div_Erro.innerHTML = 'O campo senha deve ser igual ao confirmar senha'
      finalizarAguardar();
      return false;
    }
        // div_mensagem.innerHTML = 'Usuário Autenticado';
        setInterval(sumirMensagem, 5000);


        fetch("/usuarios/cadastrar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        // crie um atributo que recebe o valor recuperado aqui
        // Agora vá para o arquivo routes/usuario.js
        nomeServer: varNome,
        sobrenomeServer: varSobrenome,
        dtNascServer: varDtNasc,
        emailServer: varEmail,
        senhaServer: varSenha
      }),
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
          mensagem_erro.innerHTML =
            "Cadastro realizado com sucesso! Redirecionando para tela de Login...";

          setTimeout(() => {
            window.location = "login.html";
          }, "2000");

          limparFormulario();
          finalizarAguardar();
        } else {
          throw "Houve um erro ao tentar realizar o cadastro!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
        finalizarAguardar();
      });

    return false;
  }
    

    

</script>